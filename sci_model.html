<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë¸Œëœë“œ ì˜¤ë””ì–¸ìŠ¤ ë¶„ì„ê¸° ë°ëª¨</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Phosphor Icons ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€ -->
  <script src="https://unpkg.com/@phosphor-icons/web@2.0.3/dist/phosphor.js"></script>
  <style>
    /* ê¸°ë³¸ í°íŠ¸ ì„¤ì • */
    body { font-family: 'Inter', sans-serif; }
    /* ì•„ì´ì½˜ ìŠ¤íƒ€ì¼ë§ */
    .ph { display: inline-block; vertical-align: middle; }
    /* ìŠ¤í”¼ë„ˆ ì•„ì´ì½˜ ì• ë‹ˆë©”ì´ì…˜ */
    .spinner-icon { animation: spin 1s linear infinite; }
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body class="min-h-screen bg-gray-100 flex items-center justify-center p-4 sm:p-6 font-sans">
  <div class="bg-white rounded-2xl shadow-xl w-full max-w-2xl p-6 sm:p-8 space-y-6">
    <div class="text-center">
      <h1 class="text-3xl sm:text-4xl font-bold text-gray-800 flex items-center justify-center space-x-2">
        <i class="ph-magnifying-glass text-indigo-500 text-[2rem]"></i>
        <span>ë¸Œëœë“œ ì˜¤ë””ì–¸ìŠ¤ ë¶„ì„</span>
      </h1>
      <p class="mt-2 text-gray-500 text-sm sm:text-base">ë¸Œëœë“œ ë‰´ìŠ¤ ê¸°ë°˜ì˜ ì˜¤ë””ì–¸ìŠ¤ ì¶”ì²œ ë°ëª¨</p>
    </div>

    <div class="space-y-4">
      <div>
        <label for="brand-input" class="block text-gray-700 font-semibold mb-1">ë¸Œëœë“œëª…</label>
        <input
          type="text"
          id="brand-input"
          value="SCì œì¼ì€í–‰"
          placeholder="ì˜ˆ: SCì œì¼ì€í–‰"
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-colors"
        />
      </div>

      <div>
        <label for="objective-input" class="block text-gray-700 font-semibold mb-1">ë§ˆì¼€íŒ… ëª©ì  (ì„ íƒ)</label>
        <input
          type="text"
          id="objective-input"
          value="ëŒ€ì¶œ ê´€ì‹¬ ê³ ê° íƒ€ê²Ÿ"
          placeholder="ì˜ˆ: ëŒ€ì¶œ ê´€ì‹¬ ê³ ê° íƒ€ê²Ÿ"
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-colors"
        />
      </div>

      <button id="analyze-button" class="w-full flex items-center justify-center px-4 py-3 text-lg font-bold rounded-lg text-white transition-all transform bg-indigo-600 hover:bg-indigo-700 active:scale-95">
        <i class="ph-arrows-clockwise text-[1.25rem] mr-2"></i>
        <span>ë¶„ì„ ì‹œì‘</span>
      </button>
    </div>

    <div id="error-message" class="hidden p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg mt-4" role="alert">
      <p class="font-bold">ì˜¤ë¥˜ ë°œìƒ</p>
      <p id="error-text"></p>
    </div>

    <!-- ê²°ê³¼ ì„¹ì…˜ -->
    <div id="results-container" class="hidden space-y-6 mt-6">
      <div>
        <h2 class="text-xl font-bold text-gray-800 border-b-2 border-indigo-400 pb-1 mb-2">
          ğŸ“° ìµœì‹  ë‰´ìŠ¤ ìš”ì•½
        </h2>
        <div id="news-summary" class="bg-gray-50 p-4 rounded-lg shadow-inner text-sm leading-relaxed text-gray-700 whitespace-pre-wrap"></div>
      </div>

      <div>
        <h2 class="text-xl font-bold text-gray-800 border-b-2 border-indigo-400 pb-1 mb-2">
          ğŸ¯ ì˜¤ë””ì–¸ìŠ¤ ì¶”ì²œ ê²°ê³¼
        </h2>
        <div id="audience-suggestions" class="bg-gray-50 p-4 rounded-lg shadow-inner text-sm leading-relaxed text-gray-700 whitespace-pre-wrap"></div>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const brandInput = document.getElementById('brand-input');
      const objectiveInput = document.getElementById('objective-input');
      const analyzeButton = document.getElementById('analyze-button');
      const newsSummaryEl = document.getElementById('news-summary');
      const audienceSuggestionsEl = document.getElementById('audience-suggestions');
      const errorMessageEl = document.getElementById('error-message');
      const errorTextEl = document.getElementById('error-text');
      const resultsContainerEl = document.getElementById('results-container');
      const originalButtonHtml = analyzeButton.innerHTML;

      const handleAnalyze = async () => {
        const brand = brandInput.value;
        const objective = objectiveInput.value;

        // UI ìƒíƒœ ì´ˆê¸°í™”
        analyzeButton.disabled = true;
        analyzeButton.classList.remove('bg-indigo-600', 'hover:bg-indigo-700', 'active:scale-95');
        analyzeButton.classList.add('bg-indigo-300', 'cursor-not-allowed');
        analyzeButton.innerHTML = `<i class="ph-spinner-gap spinner-icon mr-2 text-[1.25rem]"></i><span>ë¶„ì„ ì¤‘...</span>`;
        
        errorMessageEl.classList.add('hidden');
        resultsContainerEl.classList.add('hidden');
        newsSummaryEl.textContent = '';
        audienceSuggestionsEl.textContent = '';

        try {
          const rssUrl = `https://news.google.com/rss/search?q=${brand}&hl=ko&gl=KR&ceid=KR:ko`;
          const proxyUrl = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(rssUrl)}`;
          
          // ë‰´ìŠ¤ ë°ì´í„° ìˆ˜ì§‘
          const newsResponse = await fetch(proxyUrl);
          if (!newsResponse.ok) throw new Error('ë‰´ìŠ¤ ìˆ˜ì§‘ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
          const newsData = await newsResponse.json();
          const newsItems = newsData.items?.slice(0, 3) || [];

          if (newsItems.length === 0) {
            newsSummaryEl.textContent = 'ìµœì‹  ë‰´ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
            throw new Error('ë‰´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ë¸Œëœë“œë¥¼ ì‹œë„í•´ ë³´ì„¸ìš”.');
          }

          // ë‰´ìŠ¤ ìš”ì•½ ìƒì„±
          const summaryText = newsItems.map(item =>
            `- ${item.title} (${new Date(item.pubDate).toLocaleDateString()}): ${item.description.replace(/<[^>]*>?/gm, '')}`
          ).join('\n');
          newsSummaryEl.textContent = summaryText;

          // LLM í”„ë¡¬í”„íŠ¸ ìƒì„± (Streamlit ì•±ê³¼ ë™ì¼í•œ ë¡œì§)
          const prompt = objective
            ? `
ë‹¤ìŒì€ '${brand}'ì˜ ìµœê·¼ ë‰´ìŠ¤ ìš”ì•½ì…ë‹ˆë‹¤:
${summaryText}

'{brand}'ì˜ ë§ˆì¼€íŒ… ëª©ì ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤: "${objective}"

ìœ„ ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•´ë‹¹ ëª©ì ì— ì í•©í•œ ì˜¤ë””ì–¸ìŠ¤ë¥¼ 2~3ê°œ ì¶”ì²œí•´ ì£¼ì„¸ìš”. ê° ì˜¤ë””ì–¸ìŠ¤ëŠ” ë‹¤ìŒ í•­ëª©ì„ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤:
- ì˜¤ë””ì–¸ìŠ¤ëª…
- í–‰ë™ ì„¤ëª…
- ì¶”ì²œ ì±„ë„
- ì¶”ì²œ ìƒí’ˆ (ìˆëŠ” ê²½ìš°)
`
            : `
ë‹¤ìŒì€ '${brand}'ì— ëŒ€í•œ ìµœê·¼ ë‰´ìŠ¤ ìš”ì•½ì…ë‹ˆë‹¤:
${summaryText}

ì´ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ '${brand}'ì˜ ì£¼ìš” ì„œë¹„ìŠ¤, í¬ì§€ì…”ë‹, ì°¨ë³„ì  ì¸ì‚¬ì´íŠ¸ë¥¼ ìš”ì•½í•œ ë’¤,
ë¸Œëœë“œ íŠ¹ì„±ì— ê¸°ë°˜í•œ ì˜¤ë””ì–¸ìŠ¤ 2~3ê°œë¥¼ ì¶”ì²œí•´ ì£¼ì„¸ìš”. ê° ì˜¤ë””ì–¸ìŠ¤ëŠ” ë‹¤ìŒ í•­ëª©ì„ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤:
- ì˜¤ë””ì–¸ìŠ¤ëª…
- í–‰ë™ ì„¤ëª…
- ì¶”ì²œ ìƒí’ˆ (ìˆëŠ” ê²½ìš°)
`;
          // Gemini API í˜¸ì¶œ
          // âœ¨ ì´ ë¶€ë¶„ì„ ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤. ì‹¤ì œ API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.
          const apiKey = 'AIzaSyAPox3YnhDg60gLmdoBq6BjYt3Gm_9EudM';
          const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
          const payload = {
            contents: [{
              parts: [{ text: prompt }]
            }]
          };

          const geminiResponse = await fetch(apiUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });
          
          if (!geminiResponse.ok) {
            const errorData = await geminiResponse.json();
            throw new Error(`LLM ì‘ë‹µ ì˜¤ë¥˜: ${errorData.error?.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`);
          }

          const geminiResult = await geminiResponse.json();
          const textResult = geminiResult.candidates?.[0]?.content?.parts?.[0]?.text;
          if (textResult) {
            audienceSuggestionsEl.textContent = textResult;
          } else {
            throw new Error('LLM ì‘ë‹µì—ì„œ ìœ íš¨í•œ í…ìŠ¤íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          }
          
          resultsContainerEl.classList.remove('hidden');

        } catch (err) {
          console.error(err);
          errorTextEl.textContent = err.message;
          errorMessageEl.classList.remove('hidden');
        } finally {
          // UI ìƒíƒœ ë³µì›
          analyzeButton.disabled = false;
          analyzeButton.classList.remove('bg-indigo-300', 'cursor-not-allowed');
          analyzeButton.classList.add('bg-indigo-600', 'hover:bg-indigo-700', 'active:scale-95');
          analyzeButton.innerHTML = originalButtonHtml;
        }
      };

      analyzeButton.addEventListener('click', handleAnalyze);
    });
  </script>
</body>
</html>
